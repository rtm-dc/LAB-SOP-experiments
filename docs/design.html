<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Design | SOPs for The Lab @ DC</title>
  <meta name="description" content="Standard Operating Procedures for Experiments and Data Analysis at The Lab @ DC." />
  <meta name="generator" content="bookdown 0.44 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Design | SOPs for The Lab @ DC" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Standard Operating Procedures for Experiments and Data Analysis at The Lab @ DC." />
  <meta name="github-repo" content="rtm-dc/LAB-SOP-experiments" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Design | SOPs for The Lab @ DC" />
  
  <meta name="twitter:description" content="Standard Operating Procedures for Experiments and Data Analysis at The Lab @ DC." />
  

<meta name="author" content="Ryan T. Moore" />


<meta name="date" content="2026-01-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="getting-started.html"/>
<link rel="next" href="implementation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.34.0/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.2/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.2/js/crosstalk.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SOPs for The Lab @ DC</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="getting-started.html"><a href="getting-started.html"><i class="fa fa-check"></i><b>1</b> Getting Started</a></li>
<li class="chapter" data-level="2" data-path="design.html"><a href="design.html"><i class="fa fa-check"></i><b>2</b> Design</a>
<ul>
<li class="chapter" data-level="2.1" data-path="design.html"><a href="design.html#units"><i class="fa fa-check"></i><b>2.1</b> Units</a></li>
<li class="chapter" data-level="2.2" data-path="design.html"><a href="design.html#level-of-randomization"><i class="fa fa-check"></i><b>2.2</b> Level of Randomization</a></li>
<li class="chapter" data-level="2.3" data-path="design.html"><a href="design.html#random-assignment-methods"><i class="fa fa-check"></i><b>2.3</b> Random Assignment Methods</a></li>
<li class="chapter" data-level="2.4" data-path="design.html"><a href="design.html#sec-blocking"><i class="fa fa-check"></i><b>2.4</b> Blocking on Background Characteristics</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="design.html"><a href="design.html#applications"><i class="fa fa-check"></i><b>2.4.1</b> Applications</a></li>
<li class="chapter" data-level="2.4.2" data-path="design.html"><a href="design.html#code-examples"><i class="fa fa-check"></i><b>2.4.2</b> Code Examples</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="design.html"><a href="design.html#sec-set-seed"><i class="fa fa-check"></i><b>2.5</b> Setting the Assignment Seed</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="design.html"><a href="design.html#seeding-procedures"><i class="fa fa-check"></i><b>2.5.1</b> Seeding Procedures</a></li>
<li class="chapter" data-level="2.5.2" data-path="design.html"><a href="design.html#updating-the-seed"><i class="fa fa-check"></i><b>2.5.2</b> Updating the Seed</a></li>
<li class="chapter" data-level="2.5.3" data-path="design.html"><a href="design.html#motivation"><i class="fa fa-check"></i><b>2.5.3</b> Motivation</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="design.html"><a href="design.html#power"><i class="fa fa-check"></i><b>2.6</b> Power</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="design.html"><a href="design.html#formula-based-power-analysis"><i class="fa fa-check"></i><b>2.6.1</b> Formula-based Power Analysis</a></li>
<li class="chapter" data-level="2.6.2" data-path="design.html"><a href="design.html#formula-based-mde-minimum-detectable-effect"><i class="fa fa-check"></i><b>2.6.2</b> Formula-based MDE (minimum detectable effect)</a></li>
<li class="chapter" data-level="2.6.3" data-path="design.html"><a href="design.html#simulation-based-power-analysis"><i class="fa fa-check"></i><b>2.6.3</b> Simulation-based Power Analysis</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="design.html"><a href="design.html#balance-checking"><i class="fa fa-check"></i><b>2.7</b> Balance Checking</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="implementation.html"><a href="implementation.html"><i class="fa fa-check"></i><b>3</b> Implementation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="implementation.html"><a href="implementation.html#along-the-way"><i class="fa fa-check"></i><b>3.1</b> Along the Way</a></li>
<li class="chapter" data-level="3.2" data-path="implementation.html"><a href="implementation.html#immediately-before-the-final-randomization"><i class="fa fa-check"></i><b>3.2</b> Immediately Before the Final Randomization</a></li>
<li class="chapter" data-level="3.3" data-path="implementation.html"><a href="implementation.html#the-final-randomization"><i class="fa fa-check"></i><b>3.3</b> The Final Randomization</a></li>
<li class="chapter" data-level="3.4" data-path="implementation.html"><a href="implementation.html#immediately-after-the-final-randomization"><i class="fa fa-check"></i><b>3.4</b> Immediately After the Final Randomization</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>4</b> Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="analysis.html"><a href="analysis.html#notation"><i class="fa fa-check"></i><b>4.1</b> Notation</a></li>
<li class="chapter" data-level="4.2" data-path="analysis.html"><a href="analysis.html#estimands"><i class="fa fa-check"></i><b>4.2</b> Estimands</a></li>
<li class="chapter" data-level="4.3" data-path="analysis.html"><a href="analysis.html#sec-unadj-itt"><i class="fa fa-check"></i><b>4.3</b> The Unadjusted ITT</a></li>
<li class="chapter" data-level="4.4" data-path="analysis.html"><a href="analysis.html#sec-lin"><i class="fa fa-check"></i><b>4.4</b> Adjusting for Covariates</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="analysis.html"><a href="analysis.html#why-we-adjust-for-covariates"><i class="fa fa-check"></i><b>4.4.1</b> Why we adjust for covariates</a></li>
<li class="chapter" data-level="4.4.2" data-path="analysis.html"><a href="analysis.html#how-we-adjust-for-covariates"><i class="fa fa-check"></i><b>4.4.2</b> How we adjust for covariates</a></li>
<li class="chapter" data-level="4.4.3" data-path="analysis.html"><a href="analysis.html#sec-smallcells"><i class="fa fa-check"></i><b>4.4.3</b> Lin Adjustment with Small Cells</a></li>
<li class="chapter" data-level="4.4.4" data-path="analysis.html"><a href="analysis.html#sec-adjust-blocks"><i class="fa fa-check"></i><b>4.4.4</b> Adjusting for Blocks</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="analysis.html"><a href="analysis.html#sec-binary-outcomes"><i class="fa fa-check"></i><b>4.5</b> Binary or Count Outcomes</a></li>
<li class="chapter" data-level="4.6" data-path="analysis.html"><a href="analysis.html#clusters-weights-fixed-effects"><i class="fa fa-check"></i><b>4.6</b> Clusters, Weights, Fixed Effects</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="analysis.html"><a href="analysis.html#weights"><i class="fa fa-check"></i><b>4.6.1</b> Weights</a></li>
<li class="chapter" data-level="4.6.2" data-path="analysis.html"><a href="analysis.html#fixed-effects"><i class="fa fa-check"></i><b>4.6.2</b> Fixed Effects</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="analysis.html"><a href="analysis.html#sec-rand-inf"><i class="fa fa-check"></i><b>4.7</b> Randomization Inference</a></li>
<li class="chapter" data-level="4.8" data-path="analysis.html"><a href="analysis.html#addressing-non-compliance"><i class="fa fa-check"></i><b>4.8</b> Addressing Non-compliance</a></li>
<li class="chapter" data-level="4.9" data-path="analysis.html"><a href="analysis.html#missing-data"><i class="fa fa-check"></i><b>4.9</b> Missing Data</a></li>
<li class="chapter" data-level="4.10" data-path="analysis.html"><a href="analysis.html#multiple-comparisons"><i class="fa fa-check"></i><b>4.10</b> Multiple Comparisons</a>
<ul>
<li class="chapter" data-level="4.10.1" data-path="analysis.html"><a href="analysis.html#holm-bonferroni-adjustment"><i class="fa fa-check"></i><b>4.10.1</b> Holm-Bonferroni Adjustment</a></li>
<li class="chapter" data-level="4.10.2" data-path="analysis.html"><a href="analysis.html#westfall-young-adjustment"><i class="fa fa-check"></i><b>4.10.2</b> Westfall-Young Adjustment</a></li>
</ul></li>
<li class="chapter" data-level="4.11" data-path="analysis.html"><a href="analysis.html#posterior-probabilities"><i class="fa fa-check"></i><b>4.11</b> Posterior Probabilities</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="observational-studies.html"><a href="observational-studies.html"><i class="fa fa-check"></i><b>5</b> Observational Studies</a>
<ul>
<li class="chapter" data-level="5.1" data-path="observational-studies.html"><a href="observational-studies.html#matching"><i class="fa fa-check"></i><b>5.1</b> Matching</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="observational-studies.html"><a href="observational-studies.html#methods"><i class="fa fa-check"></i><b>5.1.1</b> Methods</a></li>
<li class="chapter" data-level="5.1.2" data-path="observational-studies.html"><a href="observational-studies.html#selecting-the-method-for-analysis"><i class="fa fa-check"></i><b>5.1.2</b> Selecting the Method for Analysis</a></li>
<li class="chapter" data-level="5.1.3" data-path="observational-studies.html"><a href="observational-studies.html#calipers"><i class="fa fa-check"></i><b>5.1.3</b> Calipers</a></li>
<li class="chapter" data-level="5.1.4" data-path="observational-studies.html"><a href="observational-studies.html#alternatives"><i class="fa fa-check"></i><b>5.1.4</b> Alternatives</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="publication.html"><a href="publication.html"><i class="fa fa-check"></i><b>6</b> Publication</a>
<ul>
<li class="chapter" data-level="6.1" data-path="publication.html"><a href="publication.html#authorship"><i class="fa fa-check"></i><b>6.1</b> Authorship</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="publication.html"><a href="publication.html#sec-labcredit"><i class="fa fa-check"></i><b>6.1.1</b> CRediT Roles at The Lab @ DC</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="publication.html"><a href="publication.html#publishing-data"><i class="fa fa-check"></i><b>6.2</b> Publishing Data</a></li>
<li class="chapter" data-level="6.3" data-path="publication.html"><a href="publication.html#presenting-results"><i class="fa fa-check"></i><b>6.3</b> Presenting Results</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="publication.html"><a href="publication.html#estimates-and-uncertainties"><i class="fa fa-check"></i><b>6.3.1</b> Estimates and uncertainties</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i><b>A</b> R Basics</a>
<ul>
<li class="chapter" data-level="A.1" data-path="r-basics.html"><a href="r-basics.html#get-r-and-rstudio"><i class="fa fa-check"></i><b>A.1</b> Get R and RStudio</a></li>
<li class="chapter" data-level="A.2" data-path="r-basics.html"><a href="r-basics.html#read-in-data-files"><i class="fa fa-check"></i><b>A.2</b> Read in data files</a>
<ul>
<li class="chapter" data-level="A.2.1" data-path="r-basics.html"><a href="r-basics.html#csv"><i class="fa fa-check"></i><b>A.2.1</b> <code>.csv</code></a></li>
<li class="chapter" data-level="A.2.2" data-path="r-basics.html"><a href="r-basics.html#xlsx"><i class="fa fa-check"></i><b>A.2.2</b> <code>.xlsx</code></a></li>
<li class="chapter" data-level="A.2.3" data-path="r-basics.html"><a href="r-basics.html#box"><i class="fa fa-check"></i><b>A.2.3</b> Box</a></li>
</ul></li>
<li class="chapter" data-level="A.3" data-path="r-basics.html"><a href="r-basics.html#pipes"><i class="fa fa-check"></i><b>A.3</b> Pipes</a></li>
<li class="chapter" data-level="A.4" data-path="r-basics.html"><a href="r-basics.html#rename-variables"><i class="fa fa-check"></i><b>A.4</b> Rename variables</a></li>
<li class="chapter" data-level="A.5" data-path="r-basics.html"><a href="r-basics.html#create-a-new-variable"><i class="fa fa-check"></i><b>A.5</b> Create a New Variable</a>
<ul>
<li class="chapter" data-level="A.5.1" data-path="r-basics.html"><a href="r-basics.html#create-a-wave-id"><i class="fa fa-check"></i><b>A.5.1</b> Create a “wave ID”</a></li>
<li class="chapter" data-level="A.5.2" data-path="r-basics.html"><a href="r-basics.html#create-a-primary-key"><i class="fa fa-check"></i><b>A.5.2</b> Create a primary key</a></li>
<li class="chapter" data-level="A.5.3" data-path="r-basics.html"><a href="r-basics.html#transform-an-existing-variable"><i class="fa fa-check"></i><b>A.5.3</b> Transform an existing variable</a></li>
<li class="chapter" data-level="A.5.4" data-path="r-basics.html"><a href="r-basics.html#create-a-sum-from-a-subset-of-variables"><i class="fa fa-check"></i><b>A.5.4</b> Create a sum from a subset of variables</a></li>
</ul></li>
<li class="chapter" data-level="A.6" data-path="r-basics.html"><a href="r-basics.html#recode-a-variables-values"><i class="fa fa-check"></i><b>A.6</b> Recode a variable’s values</a></li>
<li class="chapter" data-level="A.7" data-path="r-basics.html"><a href="r-basics.html#treat-dates-as-dates"><i class="fa fa-check"></i><b>A.7</b> Treat dates as dates</a>
<ul>
<li class="chapter" data-level="A.7.1" data-path="r-basics.html"><a href="r-basics.html#make-an-age-variable"><i class="fa fa-check"></i><b>A.7.1</b> Make an age variable</a></li>
<li class="chapter" data-level="A.7.2" data-path="r-basics.html"><a href="r-basics.html#make-a-month-count-variable"><i class="fa fa-check"></i><b>A.7.2</b> Make a month-count variable</a></li>
</ul></li>
<li class="chapter" data-level="A.8" data-path="r-basics.html"><a href="r-basics.html#sec-create-treatment"><i class="fa fa-check"></i><b>A.8</b> Create a completely randomised indicator</a></li>
<li class="chapter" data-level="A.9" data-path="r-basics.html"><a href="r-basics.html#plot-a-variable"><i class="fa fa-check"></i><b>A.9</b> Plot a variable</a></li>
<li class="chapter" data-level="A.10" data-path="r-basics.html"><a href="r-basics.html#calculate-a-data-summary"><i class="fa fa-check"></i><b>A.10</b> Calculate a data summary</a>
<ul>
<li class="chapter" data-level="A.10.1" data-path="r-basics.html"><a href="r-basics.html#proportions-for-a-categorical-variable"><i class="fa fa-check"></i><b>A.10.1</b> Proportions for a categorical variable</a></li>
<li class="chapter" data-level="A.10.2" data-path="r-basics.html"><a href="r-basics.html#proportions-for-binary-variables"><i class="fa fa-check"></i><b>A.10.2</b> Proportions for binary variables</a></li>
</ul></li>
<li class="chapter" data-level="A.11" data-path="r-basics.html"><a href="r-basics.html#merge-join-dataframes"><i class="fa fa-check"></i><b>A.11</b> Merge (join) dataframes</a></li>
<li class="chapter" data-level="A.12" data-path="r-basics.html"><a href="r-basics.html#anonymize-sensitive-data"><i class="fa fa-check"></i><b>A.12</b> Anonymize sensitive data</a>
<ul>
<li class="chapter" data-level="A.12.1" data-path="r-basics.html"><a href="r-basics.html#salting"><i class="fa fa-check"></i><b>A.12.1</b> Salting</a></li>
</ul></li>
<li class="chapter" data-level="A.13" data-path="r-basics.html"><a href="r-basics.html#deal-with-factors-orderedunordered-in-models"><i class="fa fa-check"></i><b>A.13</b> Deal with factors (ordered/unordered) in models</a></li>
</ul></li>
<li class="chapter" data-level="B" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html"><i class="fa fa-check"></i><b>B</b> Python Basics (using R/RStudio)</a>
<ul>
<li class="chapter" data-level="B.1" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#installing-tools-r-packages-and-python"><i class="fa fa-check"></i><b>B.1</b> Installing tools, R packages, and Python</a>
<ul>
<li class="chapter" data-level="B.1.1" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#get-rtools"><i class="fa fa-check"></i><b>B.1.1</b> Get Rtools</a></li>
<li class="chapter" data-level="B.1.2" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#get-tinytex"><i class="fa fa-check"></i><b>B.1.2</b> Get <code>tinytex</code></a></li>
<li class="chapter" data-level="B.1.3" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#get-python"><i class="fa fa-check"></i><b>B.1.3</b> Get Python</a></li>
<li class="chapter" data-level="B.1.4" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#configure-python"><i class="fa fa-check"></i><b>B.1.4</b> Configure Python</a></li>
<li class="chapter" data-level="B.1.5" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#get-reticulate"><i class="fa fa-check"></i><b>B.1.5</b> Get <code>reticulate</code></a></li>
</ul></li>
<li class="chapter" data-level="B.2" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#using-python"><i class="fa fa-check"></i><b>B.2</b> Using Python</a>
<ul>
<li class="chapter" data-level="B.2.1" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#from-a-python-prompt"><i class="fa fa-check"></i><b>B.2.1</b> From a Python prompt</a></li>
<li class="chapter" data-level="B.2.2" data-path="python-basics-using-rrstudio.html"><a href="python-basics-using-rrstudio.html#from-inside-a-quarto-document"><i class="fa fa-check"></i><b>B.2.2</b> From inside a Quarto document</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="C" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html"><i class="fa fa-check"></i><b>C</b> Managing Code and Scientific Communication</a>
<ul>
<li class="chapter" data-level="C.1" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#best-practices"><i class="fa fa-check"></i><b>C.1</b> Best Practices</a></li>
<li class="chapter" data-level="C.2" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#style"><i class="fa fa-check"></i><b>C.2</b> Style</a>
<ul>
<li class="chapter" data-level="C.2.1" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#r"><i class="fa fa-check"></i><b>C.2.1</b> R</a></li>
<li class="chapter" data-level="C.2.2" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#equations"><i class="fa fa-check"></i><b>C.2.2</b> Equations</a></li>
<li class="chapter" data-level="C.2.3" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#statistical-quantities"><i class="fa fa-check"></i><b>C.2.3</b> Statistical Quantities</a></li>
</ul></li>
<li class="chapter" data-level="C.3" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#sec-projects"><i class="fa fa-check"></i><b>C.3</b> Projects</a></li>
<li class="chapter" data-level="C.4" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#sec-working-dir"><i class="fa fa-check"></i><b>C.4</b> Working Directory and Relative Paths</a>
<ul>
<li class="chapter" data-level="C.4.1" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#see-the-working-directory"><i class="fa fa-check"></i><b>C.4.1</b> See the working directory</a></li>
<li class="chapter" data-level="C.4.2" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#see-the-project-directory"><i class="fa fa-check"></i><b>C.4.2</b> See the project directory</a></li>
<li class="chapter" data-level="C.4.3" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#create-a-path-with-here"><i class="fa fa-check"></i><b>C.4.3</b> Create a path with <code>here()</code></a></li>
</ul></li>
<li class="chapter" data-level="C.5" data-path="managing-code-and-scientific-communication.html"><a href="managing-code-and-scientific-communication.html#what-packages-are-installed"><i class="fa fa-check"></i><b>C.5</b> What Packages are Installed?</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="getting-started-with-git-and-github.html"><a href="getting-started-with-git-and-github.html"><i class="fa fa-check"></i><b>D</b> Getting Started with <code>git</code> and GitHub</a></li>
<li class="chapter" data-level="E" data-path="introductory-reading-at-the-lab-dc.html"><a href="introductory-reading-at-the-lab-dc.html"><i class="fa fa-check"></i><b>E</b> Introductory Reading at The Lab @ DC</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">SOPs for The Lab @ DC</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="design" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> Design<a href="design.html#design" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="units" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Units<a href="design.html#units" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We carefully define the units of observation. They maybe households, automobile
registrations, 911 callers, or students, about which we are measuring
application status, traffic tickets, primary care visits, or days of attendance
in school, respectively.</p>
</div>
<div id="level-of-randomization" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Level of Randomization<a href="design.html#level-of-randomization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We define the level of randomization, which is not always the same as
the unit of observation. In particular, the units of observation may be assigned
in <em>clusters</em>. For example, we may assign some <em>classrooms</em> to a particular
teacher-based intervention, and all students in intervention classrooms are
assigned to the same intervention. When clusters are meaningful, this has
substantial implications for our design and analysis.</p>
<p>Generally, we prefer to randomize at lower levels of aggregation – at the
student level rather than the classroom level, e.g. – because we will have more
randomization units. However, there are often logistical or statistical reasons
for assigning conditions in clusters. For example, logistically, a teacher can
only deliver one particular curriculum to their class; statistically, we may be
concerned about interference between students, where students in one condition
interact with students in the other, and causal effects of the intervention are
difficult to isolate.</p>
</div>
<div id="random-assignment-methods" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Random Assignment Methods<a href="design.html#random-assignment-methods" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>As a general rule, our preference ordering over assignment methods is</p>
<ol style="list-style-type: decimal">
<li>Blocked assignment: Assign a consistent share of each covariate group to receive the treatment (e.g., 30% Tr, 70% Co <em>within</em> homogeneous covariate groups)</li>
<li>Random allocation: Assign a consistent share of the whole sample to receive the treatment (e.g., 30% Tr, 70% Co overall)</li>
<li>Bernoulli assignment: Assign each unit independently, using a consistent probability. (e.g., each unit assigned independently, with probability 0.3 to Tr, 0.7 to Co)</li>
</ol>
<p>We have statistical reasons to prefer some assignment mechanisms over others. Assigning exactly 50 participants out of 100 to treatment will have less variance than will flipping 100 coins to assign treatment, despite the same underlying probability of treatment.</p>
<p>The choice of assignment mechanism can also matter if, for example, partners expect a certain share of participants to be treated, or if we want to ensure that the treatment probability is constant within covariate groups. When we run small lotteries, the choice tends to matter more.</p>
<p>For blocked assignments, see our motivations and methods in Section <a href="design.html#sec-blocking">2.4</a>, the slides <a href="https://github.com/ryantmoore/discussions/blob/main/997-2024-06-11_blocking.pdf">here</a>, and <span class="citation">Moore (<a href="#ref-moore12">2012</a>)</span>. Note that the assignment done within each block should be a <em>random allocation</em> of a fixed proportion of the units to each condition, not an independent Bernoulli assignment. Random allocations and blocked random allocations exploit advantages of a specific type of <em>dependence</em> among the assignments; if unit <span class="math inline">\(A\)</span> is assigned to treatment, then there is one fewer treatment slot for unit <span class="math inline">\(B\)</span> to occupy.</p>
<p>For random allocation, see the example below and the vignettes <a href="https://github.com/DeclareDesign/randomizr">here</a> and <a href="https://declaredesign.org/r/randomizr/articles/randomizr_vignette.html">here</a>. Below, note that the proportion treated equals the assignment probability.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="design.html#cb2-1" tabindex="-1"></a><span class="fu">library</span>(randomizr)</span>
<span id="cb2-2"><a href="design.html#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="design.html#cb2-3" tabindex="-1"></a><span class="co"># Assign 30 of 100 to Tr:</span></span>
<span id="cb2-4"><a href="design.html#cb2-4" tabindex="-1"></a>rand_alloc <span class="ot">&lt;-</span> <span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="dv">100</span>, <span class="at">m =</span> <span class="dv">30</span>)</span>
<span id="cb2-5"><a href="design.html#cb2-5" tabindex="-1"></a><span class="fu">table</span>(rand_alloc)</span></code></pre></div>
<pre><code>## rand_alloc
##  0  1 
## 70 30</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="design.html#cb4-1" tabindex="-1"></a><span class="co"># Assign 100 to T1, T2, T3 with probabilities (.2, .3, .5):</span></span>
<span id="cb4-2"><a href="design.html#cb4-2" tabindex="-1"></a>rand_alloc <span class="ot">&lt;-</span> <span class="fu">complete_ra</span>(<span class="at">N =</span> <span class="dv">100</span>, <span class="at">prob_each =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">3</span>, .<span class="dv">5</span>))</span>
<span id="cb4-3"><a href="design.html#cb4-3" tabindex="-1"></a><span class="fu">table</span>(rand_alloc)</span></code></pre></div>
<pre><code>## rand_alloc
## T1 T2 T3 
## 20 30 50</code></pre>
<p>For simple Bernoulli assignments, we use <code>sample()</code> or <code>randomizr::simple_ra()</code>. Below, note that the proportion treated does not generally match the underlying probability.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="design.html#cb6-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">741448875</span>)</span>
<span id="cb6-2"><a href="design.html#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="design.html#cb6-3" tabindex="-1"></a>simple_bern_50 <span class="ot">&lt;-</span> <span class="fu">simple_ra</span>(<span class="at">N =</span> <span class="dv">100</span>)</span>
<span id="cb6-4"><a href="design.html#cb6-4" tabindex="-1"></a><span class="fu">table</span>(simple_bern_50)</span></code></pre></div>
<pre><code>## simple_bern_50
##  0  1 
## 49 51</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="design.html#cb8-1" tabindex="-1"></a>simple_bern_20 <span class="ot">&lt;-</span> <span class="fu">simple_ra</span>(<span class="at">N =</span> <span class="dv">100</span>, <span class="at">prob =</span> <span class="fl">0.2</span>)</span>
<span id="cb8-2"><a href="design.html#cb8-2" tabindex="-1"></a><span class="fu">table</span>(simple_bern_20)</span></code></pre></div>
<pre><code>## simple_bern_20
##  0  1 
## 83 17</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="design.html#cb10-1" tabindex="-1"></a>bern_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb10-2"><a href="design.html#cb10-2" tabindex="-1"></a><span class="fu">table</span>(bern_sample)</span></code></pre></div>
<pre><code>## bern_sample
##  0  1 
## 56 44</code></pre>
</div>
<div id="sec-blocking" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Blocking on Background Characteristics<a href="design.html#sec-blocking" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to create balance on potential outcomes, which promotes less estimation error and more precision, we block using prognostic covariates. A <em>blocked</em> randomization first creates groups of similar randomization units, and then randomizes within those groups. The assignment done within each block should be a random allocation of a fixed proportion of the units to each condition, not an independent Bernoulli assignment.</p>
<p>In an unblocked <em>random allocation</em>, by contrast, one assigns a fixed proportion of units to each treatment condition from a single pool. See <span class="citation">Moore (<a href="#ref-moore12">2012</a>)</span> or the slides <a href="https://github.com/ryantmoore/discussions/blob/main/997-2024-06-11_blocking.pdf">here</a> for an introduction and discussion.</p>
<div id="applications" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Applications<a href="design.html#applications" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The Lab’s TANF recertification experiment <span class="citation">(<a href="#ref-mooganmin22">Moore et al. 2022</a>)</span> blocked participants on
service center and assigned visit date.</p>
</div>
<div id="code-examples" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Code Examples<a href="design.html#code-examples" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The slides <a href="https://github.com/ryantmoore/discussions/blob/main/997-2024-06-11_blocking.pdf">here</a> include an example of blocking the data, doing a random allocation within blocks, and attaching the assigned treatment conditions to the original dataframe. The code below provide similar examples.</p>
<div id="blocktools" class="section level4 hasAnchor" number="2.4.2.1">
<h4><span class="header-section-number">2.4.2.1</span> <code>{blockTools}</code><a href="design.html#blocktools" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="design.html#cb12-1" tabindex="-1"></a><span class="fu">library</span>(blockTools)</span>
<span id="cb12-2"><a href="design.html#cb12-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb12-3"><a href="design.html#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="design.html#cb12-4" tabindex="-1"></a><span class="co"># Sample data:</span></span>
<span id="cb12-5"><a href="design.html#cb12-5" tabindex="-1"></a><span class="fu">data</span>(x100) </span>
<span id="cb12-6"><a href="design.html#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="design.html#cb12-7" tabindex="-1"></a><span class="co"># Block on continuous b1, b2, within groups of g:</span></span>
<span id="cb12-8"><a href="design.html#cb12-8" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">block</span>(x100, </span>
<span id="cb12-9"><a href="design.html#cb12-9" tabindex="-1"></a>           <span class="at">groups =</span> <span class="st">&quot;g&quot;</span>,</span>
<span id="cb12-10"><a href="design.html#cb12-10" tabindex="-1"></a>           <span class="at">id.vars =</span> <span class="st">&quot;id&quot;</span>,</span>
<span id="cb12-11"><a href="design.html#cb12-11" tabindex="-1"></a>           <span class="at">block.vars =</span> <span class="fu">c</span>(<span class="st">&quot;b1&quot;</span>, <span class="st">&quot;b2&quot;</span>),</span>
<span id="cb12-12"><a href="design.html#cb12-12" tabindex="-1"></a>           <span class="at">distance =</span> <span class="st">&quot;mve&quot;</span>)</span>
<span id="cb12-13"><a href="design.html#cb12-13" tabindex="-1"></a></span>
<span id="cb12-14"><a href="design.html#cb12-14" tabindex="-1"></a><span class="co"># Assign within blocks:</span></span>
<span id="cb12-15"><a href="design.html#cb12-15" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">assignment</span>(b, <span class="at">seed =</span> <span class="dv">723876328</span>)</span>
<span id="cb12-16"><a href="design.html#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="design.html#cb12-17" tabindex="-1"></a><span class="co"># Attach conditions (here, the defaults, 1 or 2) to original data:</span></span>
<span id="cb12-18"><a href="design.html#cb12-18" tabindex="-1"></a>x100 <span class="ot">&lt;-</span> x100 <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb12-19"><a href="design.html#cb12-19" tabindex="-1"></a>  <span class="at">bt_condition =</span> <span class="fu">extract_conditions</span>(a, x100, <span class="at">id.var =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb12-20"><a href="design.html#cb12-20" tabindex="-1"></a>)</span>
<span id="cb12-21"><a href="design.html#cb12-21" tabindex="-1"></a></span>
<span id="cb12-22"><a href="design.html#cb12-22" tabindex="-1"></a><span class="fu">head</span>(x100)</span></code></pre></div>
<pre><code>##     id id2  b1  b2 g  ig bt_condition
## 1 1001 101 156 795 b 729            1
## 2 1002 102 813 469 a 627            2
## 3 1003 103 950 978 a 959            2
## 4 1004 104 991 781 a 661            2
## 5 1005 105 613 759 a 819            1
## 6 1006 106 654 838 b 643            1</code></pre>
<p>There are 36 units in group <code>a</code>, 32 in <code>b</code>, and 32 in <code>c</code>. Below, see that the assignment within blocks is perfectly half 1’s, half 2’s. Similarly, <code>b1</code> and <code>b2</code> will be better balanced on average than in an unblocked assignment. See the resources above for details.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="design.html#cb14-1" tabindex="-1"></a>x100 <span class="sc">|&gt;</span> <span class="fu">count</span>(g, bt_condition)</span></code></pre></div>
<pre><code>##   g bt_condition  n
## 1 a            1 18
## 2 a            2 18
## 3 b            1 16
## 4 b            2 16
## 5 c            1 16
## 6 c            2 16</code></pre>
</div>
<div id="randomizr" class="section level4 hasAnchor" number="2.4.2.2">
<h4><span class="header-section-number">2.4.2.2</span> <code>{randomizr}</code><a href="design.html#randomizr" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We can use <code>{randomizr}</code> to block on discrete covariates only. The example below ignores continuous variables <code>b1</code> and <code>b2</code>. Its default condition labels are 0 and 1.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="design.html#cb16-1" tabindex="-1"></a><span class="fu">library</span>(randomizr)</span>
<span id="cb16-2"><a href="design.html#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="design.html#cb16-3" tabindex="-1"></a>x100 <span class="ot">&lt;-</span> x100 <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="design.html#cb16-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">randr_condition =</span> <span class="fu">block_ra</span>(x100<span class="sc">$</span>g))</span>
<span id="cb16-5"><a href="design.html#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="design.html#cb16-6" tabindex="-1"></a><span class="fu">head</span>(x100)</span></code></pre></div>
<pre><code>##     id id2  b1  b2 g  ig bt_condition randr_condition
## 1 1001 101 156 795 b 729            1               0
## 2 1002 102 813 469 a 627            2               1
## 3 1003 103 950 978 a 959            2               1
## 4 1004 104 991 781 a 661            2               0
## 5 1005 105 613 759 a 819            1               0
## 6 1006 106 654 838 b 643            1               0</code></pre>
<p>Below, see that the assignment is perfectly half 0’s, half 1’s.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="design.html#cb18-1" tabindex="-1"></a>x100 <span class="sc">|&gt;</span> <span class="fu">count</span>(g, randr_condition)</span></code></pre></div>
<pre><code>##   g randr_condition  n
## 1 a               0 18
## 2 a               1 18
## 3 b               0 16
## 4 b               1 16
## 5 c               0 16
## 6 c               1 16</code></pre>
</div>
</div>
</div>
<div id="sec-set-seed" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Setting the Assignment Seed<a href="design.html#sec-set-seed" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Whenever our design or analysis involves randomization, we set the seed so that
our results can be perfectly replicated.</p>
<p>We set the seed at the top of the file, just after the (e.g., <code>library()</code>) commands that load and attach that file’s packages. In a short random assignment file, e.g., we might have</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="design.html#cb20-1" tabindex="-1"></a><span class="co"># Packages:</span></span>
<span id="cb20-2"><a href="design.html#cb20-2" tabindex="-1"></a><span class="fu">library</span>(dplyr) </span>
<span id="cb20-3"><a href="design.html#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="design.html#cb20-4" tabindex="-1"></a><span class="co"># Set seed:</span></span>
<span id="cb20-5"><a href="design.html#cb20-5" tabindex="-1"></a><span class="fu">set.seed</span>(SSSSSSSSS)</span>
<span id="cb20-6"><a href="design.html#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="design.html#cb20-7" tabindex="-1"></a><span class="co"># Conduct Bernoulli randomization:</span></span>
<span id="cb20-8"><a href="design.html#cb20-8" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(</span>
<span id="cb20-9"><a href="design.html#cb20-9" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, </span>
<span id="cb20-10"><a href="design.html#cb20-10" tabindex="-1"></a>                     <span class="at">size =</span> <span class="fu">n</span>(),</span>
<span id="cb20-11"><a href="design.html#cb20-11" tabindex="-1"></a>                     <span class="at">replace =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<div id="seeding-procedures" class="section level3 hasAnchor" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Seeding Procedures<a href="design.html#seeding-procedures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use two types of seeds: <em>date</em> seeds and <em>sampled</em> seeds, which we describe below. By default, we use them in the following conditions:</p>
<ol style="list-style-type: decimal">
<li>Public-relevant implementations: <em>date</em></li>
<li>Other implementations: <em>sampled</em></li>
</ol>
<p>We consider <em>public-relevant implementations</em> to include situations like a random assignment of a program to some members of a waitlist, a random selection of some households to participate in a survey, and random assignment of hypothetical treatments during confirmatory randomization inference.</p>
<p>We consider other implementations to include simulations to create example datasets, simulations to estimate power or bias, or other design or diagnostic procedures.</p>
<div id="date-seeds" class="section level4 hasAnchor" number="2.5.1.1">
<h4><span class="header-section-number">2.5.1.1</span> <em>Date</em> Seeds<a href="design.html#date-seeds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To seed the random seed, run at the R prompt</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="design.html#cb21-1" tabindex="-1"></a><span class="fu">set.seed</span>(YYMMDDHH)</span></code></pre></div>
<p>where <code>YY</code> is the two-digit year (<code>23</code> for 2023), <code>MM</code> is the two-digit month,
<code>DD</code> is the two-digit date, and <code>HH</code> is the two-digit hour (between <code>00</code> and
<code>23</code>) of implementation.</p>
</div>
<div id="sampled-seeds" class="section level4 hasAnchor" number="2.5.1.2">
<h4><span class="header-section-number">2.5.1.2</span> <em>Sampled</em> Seeds<a href="design.html#sampled-seeds" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To set the random seed, run at the R prompt only once</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="design.html#cb22-1" tabindex="-1"></a><span class="fu">sample</span>(<span class="fl">1e9</span>, <span class="dv">1</span>)</span></code></pre></div>
<p>then copy and paste the result as the argument of <code>set.seed()</code>. If the result of
<code>sample(1e9, 1)</code> is <code>SSSSSSSSS</code>, then set the seed with</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="design.html#cb23-1" tabindex="-1"></a><span class="fu">set.seed</span>(SSSSSSSSS)</span></code></pre></div>
</div>
</div>
<div id="updating-the-seed" class="section level3 hasAnchor" number="2.5.2">
<h3><span class="header-section-number">2.5.2</span> Updating the Seed<a href="design.html#updating-the-seed" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We update <code>date</code> seeds to reflect the last time that the code was run for implementation.</p>
<p>We do not need to update <code>sampled</code> seeds in our other design, demonstration, or diagnostic code.</p>
</div>
<div id="motivation" class="section level3 hasAnchor" number="2.5.3">
<h3><span class="header-section-number">2.5.3</span> Motivation<a href="design.html#motivation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We want to ensure that our stochastic work can be exactly replicated. We do not
manipulate seeds to obtain particular results. However, we do not want our draws
to be entirely dependent within a given date, and we note that some
seemingly-random phenomena are sometimes later found to have patterns. For an
example of dependence, consider these two different draws that use the same
seed:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="design.html#cb24-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">758296545</span>)</span>
<span id="cb24-2"><a href="design.html#cb24-2" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">100</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>##  [1] 11 22 88 94 25 76  1  4 64 12</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="design.html#cb26-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">758296545</span>)</span>
<span id="cb26-2"><a href="design.html#cb26-2" tabindex="-1"></a><span class="fu">sample</span>(<span class="dv">100</span>, <span class="dv">20</span>)</span></code></pre></div>
<pre><code>##  [1] 11 22 88 94 25 76  1  4 64 12 35 45 65 77 34 91 90  6 27  3</code></pre>
<p>Note that the first 10 cases are identical.</p>
</div>
</div>
<div id="power" class="section level2 hasAnchor" number="2.6">
<h2><span class="header-section-number">2.6</span> Power<a href="design.html#power" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We conduct power analysis to determine how precise our experiment are likely to
be. Power analysis should go beyond sample size, and attempt to account for as
many features of the design, implementation, and analysis as possible. Sometimes
we can achieve this with “formula-based” power strategies; other times we need
to use simulation-based techniques. Power analyses should be conducted in code,
so that they are replicable. If we use an online calculator for a quick
calculation, we replicate the results in code.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>If our design and analysis plan match the assumptions of a formula-based power
calculation well, we perform a formula-based power calculation. For example, if
the design is complete randomization and the analysis plan is to conduct a
two-sample <span class="math inline">\(t\)</span>-test, we might use R’s <code>power.t.test()</code>, as below. However, if
the design includes blocked assignment in several waves, untreated units stay in
the pool across waves, and assignment probabilities vary by wave, with an
analysis plan of covariance-adjusted Lin <a href="analysis.html#sec-lin">estimation</a> with strong
covariates, then we need to use simulation. If we can’t find a formula-based
approach that sufficiently approximates our design and analysis plan, we use
simulation.</p>
<div id="formula-based-power-analysis" class="section level3 hasAnchor" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Formula-based Power Analysis<a href="design.html#formula-based-power-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An example of formula-based power calculation, where the design is complete randomization and the analysis plans for a two-sample <span class="math inline">\(t\)</span>-test:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r fold.hide"><code class="sourceCode r"><span id="cb28-1"><a href="design.html#cb28-1" tabindex="-1"></a>power_out <span class="ot">&lt;-</span> <span class="fu">power.t.test</span>(<span class="at">delta =</span> <span class="dv">1</span>, </span>
<span id="cb28-2"><a href="design.html#cb28-2" tabindex="-1"></a>                          <span class="at">sd =</span> <span class="dv">1</span>,</span>
<span id="cb28-3"><a href="design.html#cb28-3" tabindex="-1"></a>                          <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb28-4"><a href="design.html#cb28-4" tabindex="-1"></a>                          <span class="at">power =</span> <span class="fl">0.8</span>)</span>
<span id="cb28-5"><a href="design.html#cb28-5" tabindex="-1"></a>power_out</span></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 16.71477
##           delta = 1
##              sd = 1
##       sig.level = 0.05
##           power = 0.8
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<p>For two equally-sized samples drawn from a population with standard normal
outcomes, we need 17 observations in each group to have a
probability of 0.8 of detecting a true effect that is one
standard deviation of the outcome in size, where “detecting” means rejecting a
null hypothesis of <span class="math inline">\(H_0: \mu_{Tr} = \mu_{Co}\)</span> against an alternative of <span class="math inline">\(H_a:
\mu_{Tr} \neq \mu_{Co}\)</span> using <span class="math inline">\(\alpha = 0.05\)</span>.</p>
</div>
<div id="formula-based-mde-minimum-detectable-effect" class="section level3 hasAnchor" number="2.6.2">
<h3><span class="header-section-number">2.6.2</span> Formula-based MDE (minimum detectable effect)<a href="design.html#formula-based-mde-minimum-detectable-effect" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>An example of a formula-based MDE calculation follows, where the analysis plans
for a two-sample test of proportions. The sample size is 75 (in <em>each</em> group),
and we want to detect stipulated effects with probability 0.8. Below, we make
the most conservative (SE-maximizing) possible assumption about the base rate,
that it is 0.5.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r fold.hide"><code class="sourceCode r"><span id="cb30-1"><a href="design.html#cb30-1" tabindex="-1"></a>power_out_mde <span class="ot">&lt;-</span> <span class="fu">power.prop.test</span>(<span class="at">n =</span> <span class="dv">75</span>, </span>
<span id="cb30-2"><a href="design.html#cb30-2" tabindex="-1"></a>                                 <span class="at">p1 =</span> <span class="fl">0.5</span>,</span>
<span id="cb30-3"><a href="design.html#cb30-3" tabindex="-1"></a>                                 <span class="at">power =</span> <span class="fl">0.8</span>)</span>
<span id="cb30-4"><a href="design.html#cb30-4" tabindex="-1"></a>power_out_mde</span></code></pre></div>
<pre><code>## 
##      Two-sample comparison of proportions power calculation 
## 
##               n = 75
##              p1 = 0.5
##              p2 = 0.7213224
##       sig.level = 0.05
##           power = 0.8
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r fold.hide"><code class="sourceCode r"><span id="cb32-1"><a href="design.html#cb32-1" tabindex="-1"></a>power_out_mde<span class="sc">$</span>p2 <span class="sc">-</span> power_out_mde<span class="sc">$</span>p1</span></code></pre></div>
<pre><code>## [1] 0.2213224</code></pre>
<p>We see a minimum detectable effect of about 0.22, over a base rate of 0.5.</p>
</div>
<div id="simulation-based-power-analysis" class="section level3 hasAnchor" number="2.6.3">
<h3><span class="header-section-number">2.6.3</span> Simulation-based Power Analysis<a href="design.html#simulation-based-power-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulation-based power analysis allows us to estimate the power of any
combination of randomization technique, missing data treatment, estimation
strategy, etc. that we like.</p>
<p>Create some data to illustrate simulation-based power analysis:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="design.html#cb34-1" tabindex="-1"></a><span class="fu">library</span>(estimatr)</span>
<span id="cb34-2"><a href="design.html#cb34-2" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb34-3"><a href="design.html#cb34-3" tabindex="-1"></a></span>
<span id="cb34-4"><a href="design.html#cb34-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">988869862</span>)</span>
<span id="cb34-5"><a href="design.html#cb34-5" tabindex="-1"></a></span>
<span id="cb34-6"><a href="design.html#cb34-6" tabindex="-1"></a>n_samp <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb34-7"><a href="design.html#cb34-7" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rchisq</span>(n_samp, <span class="at">df =</span> <span class="dv">3</span>),</span>
<span id="cb34-8"><a href="design.html#cb34-8" tabindex="-1"></a>             <span class="at">z =</span> <span class="fu">rbinom</span>(n_samp, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb34-9"><a href="design.html#cb34-9" tabindex="-1"></a>             <span class="at">y =</span> x <span class="sc">+</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n_samp, <span class="at">sd =</span> <span class="fl">1.1</span>))</span>
<span id="cb34-10"><a href="design.html#cb34-10" tabindex="-1"></a></span>
<span id="cb34-11"><a href="design.html#cb34-11" tabindex="-1"></a><span class="fu">save</span>(df, <span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;02-01-df.RData&quot;</span>))</span></code></pre></div>
<p>Suppose the estimation strategy is linear regression <span class="math inline">\(y_i = \beta_0 + \beta_1 z_i +  \beta_2 x_i + \epsilon_i\)</span> with heteroskedasticity-robust HC2 standard errors, and the coefficient of interest is <span class="math inline">\(\beta_1\)</span>. Perform 1000 reassignments and determine what proportion of them reveal <span class="math inline">\(\hat{\beta}_1\)</span> that is statistically significant at <span class="math inline">\(\alpha = 0.05\)</span>.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="design.html#cb35-1" tabindex="-1"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb35-2"><a href="design.html#cb35-2" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb35-3"><a href="design.html#cb35-3" tabindex="-1"></a>true_te <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb35-4"><a href="design.html#cb35-4" tabindex="-1"></a></span>
<span id="cb35-5"><a href="design.html#cb35-5" tabindex="-1"></a>is_stat_sig <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;logical&quot;</span>, n_sims) <span class="co"># Storage</span></span>
<span id="cb35-6"><a href="design.html#cb35-6" tabindex="-1"></a></span>
<span id="cb35-7"><a href="design.html#cb35-7" tabindex="-1"></a><span class="cf">for</span>(idx <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims){</span>
<span id="cb35-8"><a href="design.html#cb35-8" tabindex="-1"></a>  </span>
<span id="cb35-9"><a href="design.html#cb35-9" tabindex="-1"></a>  <span class="co"># Re-assign treatment and recalculate outcomes n_sims times:</span></span>
<span id="cb35-10"><a href="design.html#cb35-10" tabindex="-1"></a>  <span class="co"># (Note: conditions on original x in df, but not original y.)</span></span>
<span id="cb35-11"><a href="design.html#cb35-11" tabindex="-1"></a>  df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">z_tmp =</span> <span class="fu">rbinom</span>(n_samp, <span class="dv">1</span>, <span class="at">prob =</span> <span class="fl">0.5</span>),</span>
<span id="cb35-12"><a href="design.html#cb35-12" tabindex="-1"></a>                     <span class="at">y_tmp =</span> true_te <span class="sc">*</span> z_tmp <span class="sc">+</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">1.1</span>))</span>
<span id="cb35-13"><a href="design.html#cb35-13" tabindex="-1"></a>  </span>
<span id="cb35-14"><a href="design.html#cb35-14" tabindex="-1"></a>  <span class="co"># Estimation:</span></span>
<span id="cb35-15"><a href="design.html#cb35-15" tabindex="-1"></a>  lm_out <span class="ot">&lt;-</span> <span class="fu">lm_robust</span>(y_tmp <span class="sc">~</span> z_tmp <span class="sc">+</span> x, <span class="at">data =</span> df)</span>
<span id="cb35-16"><a href="design.html#cb35-16" tabindex="-1"></a>  </span>
<span id="cb35-17"><a href="design.html#cb35-17" tabindex="-1"></a>  <span class="co"># Store p-value:</span></span>
<span id="cb35-18"><a href="design.html#cb35-18" tabindex="-1"></a>  stat_sig_tmp <span class="ot">&lt;-</span> lm_out<span class="sc">$</span>p.value[<span class="st">&quot;z_tmp&quot;</span>]</span>
<span id="cb35-19"><a href="design.html#cb35-19" tabindex="-1"></a>  </span>
<span id="cb35-20"><a href="design.html#cb35-20" tabindex="-1"></a>  <span class="co"># Store whether true effect is &#39;detected&#39;:</span></span>
<span id="cb35-21"><a href="design.html#cb35-21" tabindex="-1"></a>  is_stat_sig[idx] <span class="ot">&lt;-</span> (stat_sig_tmp <span class="sc">&lt;=</span> alpha)</span>
<span id="cb35-22"><a href="design.html#cb35-22" tabindex="-1"></a>}</span>
<span id="cb35-23"><a href="design.html#cb35-23" tabindex="-1"></a></span>
<span id="cb35-24"><a href="design.html#cb35-24" tabindex="-1"></a><span class="fu">mean</span>(is_stat_sig)</span></code></pre></div>
<pre><code>## [1] 0.995</code></pre>
<p>So the probability of detecting the true average treatment effect of 1 is about 0.995. This high power comes largely from the strongly predictive nature of the covariate <code>x</code>. Note that a naïve formula-based approach that ignores the data generating process estimates the power to be roughly 0.45.</p>
</div>
</div>
<div id="balance-checking" class="section level2 hasAnchor" number="2.7">
<h2><span class="header-section-number">2.7</span> Balance Checking<a href="design.html#balance-checking" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To increase our certainty that our treatment and control conditions are balanced on predictive covariates, we compare the distributions of covariates. For example, in <span class="citation">Moore et al. (<a href="#ref-mooganmin22">2022</a>)</span>, we describe</p>
<blockquote>
<p>the median absolute deviation (MAD) of appointment dates is about 0.15 days (about 3.5 hours) or less in 99% of the trios. In other words, the medians of the treatment and control groups tend to vary by much less than a day across the months and Service Centers.</p>
</blockquote>

</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-moore12" class="csl-entry">
Moore, Ryan T. 2012. <span>“Multivariate Continuous Blocking to Improve Political Science Experiments.”</span> <em>Political Analysis</em> 20 (4): 460–79.
</div>
<div id="ref-mooganmin22" class="csl-entry">
Moore, Ryan T., Katherine N. Gan, Karissa Minnich, and David Yokum. 2022. <span>“Anchor Management: A Field Experiment to Encourage Families to Meet Critical Programme Deadlines.”</span> <em>Journal of Public Policy</em> 42 (4): 615–36. <a href="https://doi.org/10.1017/S0143814X21000131">https://doi.org/10.1017/S0143814X21000131</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>An online power calculator is
available from <a href="https://egap.shinyapps.io/Power_Calculator/">EGAP</a>, e.g.<a href="design.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="getting-started.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="implementation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
